
## Описание проекта

Основная цель проекта — расчет и визуализация пользовательских и экономических показателей компании по доставке еды. Визуализация показателей удержания (Retention), среднего дохода на платящего пользователя (ARPPU) и прочих метрик помогает бизнесу принимать объективные решения. Проект также полезен наличием инструкций по настройке Superset BI, использованию его функционала, включая создание виртуальных датасетов и применение виртуальных стилей оформления. В папках проекта содержатся данные для анализа в формате CSV, а также SQL-скрипты для загрузки и трансформации данных. В описании проекта присутствуют инструкции по его запуску.

<img src="https://raw.githubusercontent.com/vlkudriashev/superset_project/master/analytics_dashboard.jpg" width=75%>

## Используемые технологии

Apache Superset, PostgreSQL, Docker.

## Содержание

* [Установка](#установка)
* [Обработка данных](#обработка-данных)
* [Визуализация данных](#визуализация-данных)
	
## Установка

### Установка Docker 

Для работы с проектом необходимо установить docker локально на компьютере с Linux в соответствии с официальной инструкцией: https://docs.docker.com/engine/install/ubuntu/.
	
### Настройка сети
	
 Далее создаётся единая сеть, чтобы контейнеры приложений BI-системы и СУБД PostgreSQL могли взаимодействовать друг с другом:

	docker network create app_net
		
### Настройка Docker-образа Postgres

Теперь нужно создать том для хранения данных СУБД PostgreSQL, чтобы избежать потери данных при дальнейшей работе с наборами данных из базы.
		
	docker volume create postgres_volume

Наконец можно запустить контейнер с СУБД PostgreSQL.

	sudo docker run -d \
		--name postgres_1 \
		-e POSTGRES_PASSWORD=postgres_admin \
		-e POSTGRES_USER=postgres_admin \
		-e POSTGRES_DB=test_app \
		-v postgres_volume:/var/lib/postgresql/data \
		--net=app_net \
		-p 5432:5432 \
		postgres:14	
	
### Настройка Docker-образа Superset

По аналогии, создаётся том для хранения данных Superset и обозначается секретный ключ для запуска Superset.

	docker volume superset_volume
	
	sudo docker run -d \
		--net=app_net -p 80:8088 \
		-e "SUPERSET_SECRET_KEY=YOUR_SECRET_KEY" \
		--name superset apache/superset
	
Больше информации о запуске Superset можно найти в официальной документации к докер образу: https://hub.docker.com/r/apache/superset.
	
## Обработка данных

### Описание наборов данных

В папке "csv-files" проекта содержатся файлы в формате CSV. Файлы содержат архивные данные о клиентах и их транзакциях интернет-магазина по доставке еды.

### Загрузка данных в Postgres

Исходные данные в формате CSV можно загрузить в базу данных, используя систему управления данными, такую как DBeaver. Также можно использовать командную строку и команду COPY. Поскольку встроенные средства управления данными могут испытывать трудности с корректной обработкой csv-файлов, мы импортируем все столбцы временных меток и данные массива как тип varchar, а затем преобразуем их с помощью операций DML. Остальные данные могут быть импортированы как целочисленный тип.

Затем мы запускаем команды DML для обработки данных CSV в следующем порядке:

* Скрипт "clean_order_data" форматирует данные для преобразования в тип массива.
* Скрипт "change_order_data_type" преобразует данные в тип данных массива.
* Скрипт "change_order_creation_time" преобразует импортированные временные метки в формате varchar в корректный формат временных меток (timestamp).
		
## Визуализация данных

### Создание виртуальных наборов данных (Virtual Datasets)

Для визуализации данных сначала следует создать виртуальные наборы данных в качестве основы для графиков. В папке «sql-scripts» представлены соответствующие SQL-скрипты. Их необходимо выполнить в редакторе SQL-Lab в определенной последовательности, создавая свой набор данных на основе каждого скрипта. После этого можно переходить к созданию графиков.
	
* #### Набор данных 1: Платящие пользователи и общее количество заказов
    
     Этот набор данных создается на основе скрипта «paying_users_and_total_orders» и служит основой для серии графиков «Большое число с линией тренда» ("Big Number with Trendline") в верхней части дашборда. Графики отображают общее количество платящих пользователей и совершенных заказов за указанный период. Линия тренда позволяет определить динамику пользовательской базы.
	
* #### Набор данных 2: Новые и общее количество пользователей

	Набор данных, созданный на основе скрипта «new_and_total_users», служит основой для «Смешанной диаграммы» ("Mixed Chart") на левой стороне визуализации. Диаграмма демонстрирует количество новых пользователей и общую пользовательскую базу за указанный период времени. На линейном графике отображается общее количество пользователей, на столбчатом – количество новых. Это помогает понять динамику роста пользовательской базы и роль новых пользователей в этом процессе.

* #### Набор данных 3: ARPU, ARPPU, AOV
	
	Набор данных на основе скрипта «arpu_arppu_aov» служит основой для линейной диаграммы ("Line Chart") на правой стороне визуализации. Она отображает средний доход на пользователя (ARPU), доход на платящего пользователя (ARPPU) и среднюю стоимость заказа (AOV) за указанный период. Это помогает оценить доход от пользовательской базы, влияние новых платящих пользователей.

* #### Набор данных 4: Показатель удержания пользователей (Retention rate)
	
	Набор данных, основанный на скрипте «retention_calculation», становится сводной таблицей ("Pivot table") в центральной части визуализации. Таблица отражает уровень удержания пользователей – долю пользователей, продолжающих оставаться активными после заданного периода. Это позволяет оценить уровень удержания и влияющие на него факторы.
	
### Применение CSS-стилей

Superset по умолчанию выравнивает данные в ячейках сводной таблицы по левому краю. Это может быть не очень удобно для восприятия информации, поэтому мы можем центрировать положение значений в ячейках, чтобы улучшить читаемость и эстетику таблицы.
	
Больше о работе со стилями можно узнать из официального блога компании Preset: https://preset.io/blog/customizing-superset-dashboards-with-css/
	
## Благодарности
	
Я хотел бы поблагодарить Антона Сидорина - бэкенд-разработчика из Karpov Sources за подробные Youtube-инструкции по запуску контейнеров Docker.